<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Going completely offline with Vespucci - Vespucci</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/docco.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">

<!--
                <a class="navbar-brand" href="../..">Vespucci</a> -->
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
<!--                            <li class="navitem">
                                <a href="../.." class="nav-link">Vespucci</a>
</li> -->
                                <li class="navitem">
                                    
                                        <a href="../.."><img src="/vespucci_logo_small.png"></a>
                                </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Introduction <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../help/en/Introduction/" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../features/" class="dropdown-item">Features</a>
</li>
                                    
<li>
    <a href="../../help/en/18.0.0%20Release%20notes/" class="dropdown-item">18.0.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/17.1.0%20Release%20notes/" class="dropdown-item">17.1.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/17.0.0%20Release%20notes/" class="dropdown-item">17.0.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/16.1.0%20Release%20notes/" class="dropdown-item">16.1.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/16.0.0%20Release%20notes/" class="dropdown-item">16.0.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/15.2.0%20Release%20notes/" class="dropdown-item">15.2.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/15.1.0%20Release%20notes/" class="dropdown-item">15.1.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/15.0.0%20Release%20notes/" class="dropdown-item">15.0.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/14.1.0%20Release%20notes/" class="dropdown-item">14.1.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/14.0.0%20Release%20notes/" class="dropdown-item">14.0.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/13.1.0%20Release%20notes/" class="dropdown-item">13.1.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/13.0.0%20Release%20notes/" class="dropdown-item">13.0.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/12.1.0%20Release%20notes/" class="dropdown-item">12.1.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/12.0.0%20Release%20notes/" class="dropdown-item">12.0.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/11.2.0%20Release%20notes/" class="dropdown-item">11.2.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/11.1.0%20Release%20notes/" class="dropdown-item">11.1.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/11.0.0%20Release%20notes/" class="dropdown-item">11.0.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/10.2.0%20Release%20notes/" class="dropdown-item">10.2.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/10.1.0%20Release%20notes/" class="dropdown-item">10.1.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/10.0.0%20Release%20notes/" class="dropdown-item">10.0.0 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/0.9.9%20Release%20notes/" class="dropdown-item">0.9.9 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/0.9.8%20Release%20notes/" class="dropdown-item">0.9.8 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/0.9.7%20Release%20notes/" class="dropdown-item">0.9.7 Release notes</a>
</li>
                                    
<li>
    <a href="../../help/en/0.9.6%20Release%20notes/" class="dropdown-item">0.9.6 Release notes</a>
</li>
                                    
<li>
    <a href="../old_release_notes/" class="dropdown-item">Previous release notes</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Editing <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../help/en/Main%20map%20display/" class="dropdown-item">Main map display</a>
</li>
                                    
<li>
    <a href="../../help/en/Simple%20actions/" class="dropdown-item">Simple actions</a>
</li>
                                    
<li>
    <a href="../../help/en/Creating%20new%20objects/" class="dropdown-item">Creating new objects</a>
</li>
                                    
<li>
    <a href="../../help/en/Node%20selected/" class="dropdown-item">Node selected</a>
</li>
                                    
<li>
    <a href="../../help/en/Way%20selected/" class="dropdown-item">Way selected</a>
</li>
                                    
<li>
    <a href="../../help/en/Relation%20selected/" class="dropdown-item">Relation selected</a>
</li>
                                    
<li>
    <a href="../../help/en/New%20Note%20selected/" class="dropdown-item">New note selected</a>
</li>
                                    
<li>
    <a href="../../help/en/Property%20editor/" class="dropdown-item">Property editor</a>
</li>
                                    
<li>
    <a href="../../help/en/Multiselect/" class="dropdown-item">Multiselect</a>
</li>
                                    
<li>
    <a href="../../help/en/Conflict%20resolution/" class="dropdown-item">Conflict resolution</a>
</li>
                                    
<li>
    <a href="../../help/en/Presets/" class="dropdown-item">Presets</a>
</li>
                                    
<li>
    <a href="../../help/en/Aligning%20background%20imagery/" class="dropdown-item">Aligning background imagery</a>
</li>
                                    
<li>
    <a href="../../help/en/Keyboard/" class="dropdown-item">Keyboard and mouse</a>
</li>
                                    
<li>
    <a href="../../help/en/GPS%20sources/" class="dropdown-item">GPS sources</a>
</li>
                                    
<li>
    <a href="../../help/en/Tag%20filter/" class="dropdown-item">Tag based filter</a>
</li>
                                    
<li>
    <a href="../../help/en/Preset%20filter/" class="dropdown-item">Preset based filter</a>
</li>
                                    
<li>
    <a href="../../help/en/Opening%20hours/" class="dropdown-item">Opening hours</a>
</li>
                                    
<li>
    <a href="../../help/en/Preferences/" class="dropdown-item">Preferences</a>
</li>
                                    
<li>
    <a href="../../help/en/Advanced%20preferences/" class="dropdown-item">Advanced preferences</a>
</li>
                                    
<li>
    <a href="../../help/en/Voice%20commands/" class="dropdown-item">Voice commands</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Tutorials and Posts <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../network_location/" class="dropdown-item">"network" Location Provider Support</a>
</li>
                                    
<li>
    <a href="../custom_imagery/" class="dropdown-item">Custom imagery</a>
</li>
                                    
<li>
    <a href="../custom_imagery_mbtiles/" class="dropdown-item">Generating MBTiles files with custom imagery</a>
</li>
                                    
<li>
    <a href="../name_suggestions/" class="dropdown-item">Using name suggestions</a>
</li>
                                    
<li>
    <a href="../reporting_issues/" class="dropdown-item">Reporting Vespucci issues</a>
</li>
                                    
<li>
    <a href="../tag_only/" class="dropdown-item">Tag-only editing</a>
</li>
                                    
<li>
    <a href="../presets/" class="dropdown-item">Vespucci presets</a>
</li>
                                    
<li>
    <a href="../data_styling/" class="dropdown-item">Vespucci data styling</a>
</li>
                                    
<li>
    <a href="../vespucci_intents/" class="dropdown-item">Controlling Vespucci from other apps</a>
</li>
                                    
<li>
    <a href="../object_search/" class="dropdown-item">Object search</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Going completely offline with Vespucci</a>
</li>
                                    
<li>
    <a href="../mapbox-style/" class="dropdown-item">Mapbox-GL Style Support</a>
</li>
                                </ul>
                            </li>
<!--                            <li class="navitem">
                                <a href="../screenshots/" class="nav-link">Videos & Screenshots</a>
</li> -->
                                <li class="navitem">
                                    
                                        <a href="../screenshots/">Videos & Screenshots</a>
                                </li>
<!--                            <li class="navitem">
                                <a href="../faq/" class="nav-link">FAQ</a>
</li> -->
                                <li class="navitem">
                                    
                                        <a href="../faq/">FAQ</a>
                                </li>
<!--                            <li class="navitem">
                                <a href="../../help/en/Privacy/" class="nav-link">Privacy</a>
</li> -->
                                <li class="navitem">
                                    
                                        <a href="../../help/en/Privacy/">Privacy</a>
                                </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>

<!--
                            <li class="nav-item">
                                <a rel="prev" href="../object_search/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../mapbox-style/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li> -->
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
<!--                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#going-completely-offline-with-vespucci" class="nav-link">Going completely offline with Vespucci</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
<div class="col-md-9" role="main">

<h1 id="going-completely-offline-with-vespucci">Going completely offline with Vespucci</h1>
<p><em>This is based on two OpenStreetMap diary posts from late 2018</em></p>
<p align="center">
  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/43/Caf%C3%A9_Wall_Illusion.svg/500px-Caf%C3%A9_Wall_Illusion.svg.png" />
</p>

<p>Vespucci has supported unconnected mapping since day one, more than a decade ago, and that has improved over the years with addition of support for reading and saving files in OSM and JOSM xml format (the JOSM format stores information on your changes).</p>
<p>In version 10.1, in early 2018, we added support for MBTiles files for local on device background imagery sources, supporting building an imagery source while you are online on your desktop and avoiding having to download to the Vespucci imagery cache manually, a rather tiresome undertaking.</p>
<p>But despite all of this, the main problem remained that you had to keep OSM data files on device reasonably small because the contents would be read in total in to memory and while such areas can be quite large on a modern phone, things do tend to get slow. And as we all know when you  make a selection in advance, Murphy comes in to play and you are surely are going to miss exactly the area that you suddenly stumbled in to. </p>
<p>To get around all of that I've been investigating a compact, indexed in one way or the other, on device format for raw OSM data for quite a while, and now have a solution that works even better than originally envisioned.</p>
<p>The format is a MBTiles format sqlite database containing tiled OSM data in PBF format. The format goes back to 2011 and the application <a href="https://github.com/simonpoole/mapsplit">mapsplit</a> created by well known OSMer Peter Barth, at the time used to prepare input for <a href="http://osm2world.org/">OSM2World</a>. The slight rework that I started in late 2018 adds support for producing output in MBTile format (instead of copying a couple of 100'000 or so files to your mobile), higher and variable maximum zoom level for the tiles and an optimisation pass. </p>
<p>When generated from OSM source data that has referentially complete ways, the individual tiles are referentially complete too. That means a tile will contain all nodes referenced by ways included in the tile, and all relations that have members in the tile (but not all members of those relations). If input data contains metadata fields (that is OSM id, version and date) the resulting files can be used by OSM editors just as data from the API. Naturally the data will be at least a bit stale and that needs to be taken in to account when using it in an editor.</p>
<p>Having all of Switzerland (not exactly an empty country in OSM) currently will use 1.1GB, which compares quite well to the original PBF file it was generated from (421MB). Some of the overhead is due to having to duplicate ways crossing tile boundaries and including relations in every tile that has a member element and tiles with little content not compressing well.</p>
<p>To update the tiles it is currently necessary to re-tile the data (after either downloading a new extract or keeping the extract up to date from the diffs). This is not a big deal, generating the tiles for Switzerland from scratch only takes a couple of minutes, but naturally the holy grail is to update in situ on device, doing away with the need for a desktop completely. There are some hurdles that need to be taken before we are there, but it seems to be completely possible. Even if that turns out to be not practical there are some potentially interesting intermediate steps that I'm exploring, for example updating the tiles with the local edits (after they have been uploaded and received definitive IDs).</p>
<p>While you can simply download the <a href="https://github.com/simonpoole/mapsplit/releases">current release</a> and generate files yourself, to make life easier for user that just want to quickly try things out, I'm generating some files for some regions on a daily basis on <a href="https://mapsplit.poole.ch/">https://mapsplit.poole.ch/</a>. Within reason I can add more if there is interest.</p>
<p>To configure MapSplit files as a data source in Vespucci, see the <a href="http://vespucci.io/help/en/13.0.0%20Release%20notes/#add-support-for-mapsplit-tiled-osm-data">13.0 release notes</a>.</p></div> -->
		    
                    	<div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#going-completely-offline-with-vespucci" class="nav-link">Going completely offline with Vespucci</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    	<div class="col-md-9" role="main">

<h1 id="going-completely-offline-with-vespucci">Going completely offline with Vespucci</h1>
<p><em>This is based on two OpenStreetMap diary posts from late 2018</em></p>
<p align="center">
  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/43/Caf%C3%A9_Wall_Illusion.svg/500px-Caf%C3%A9_Wall_Illusion.svg.png" />
</p>

<p>Vespucci has supported unconnected mapping since day one, more than a decade ago, and that has improved over the years with addition of support for reading and saving files in OSM and JOSM xml format (the JOSM format stores information on your changes).</p>
<p>In version 10.1, in early 2018, we added support for MBTiles files for local on device background imagery sources, supporting building an imagery source while you are online on your desktop and avoiding having to download to the Vespucci imagery cache manually, a rather tiresome undertaking.</p>
<p>But despite all of this, the main problem remained that you had to keep OSM data files on device reasonably small because the contents would be read in total in to memory and while such areas can be quite large on a modern phone, things do tend to get slow. And as we all know when you  make a selection in advance, Murphy comes in to play and you are surely are going to miss exactly the area that you suddenly stumbled in to. </p>
<p>To get around all of that I've been investigating a compact, indexed in one way or the other, on device format for raw OSM data for quite a while, and now have a solution that works even better than originally envisioned.</p>
<p>The format is a MBTiles format sqlite database containing tiled OSM data in PBF format. The format goes back to 2011 and the application <a href="https://github.com/simonpoole/mapsplit">mapsplit</a> created by well known OSMer Peter Barth, at the time used to prepare input for <a href="http://osm2world.org/">OSM2World</a>. The slight rework that I started in late 2018 adds support for producing output in MBTile format (instead of copying a couple of 100'000 or so files to your mobile), higher and variable maximum zoom level for the tiles and an optimisation pass. </p>
<p>When generated from OSM source data that has referentially complete ways, the individual tiles are referentially complete too. That means a tile will contain all nodes referenced by ways included in the tile, and all relations that have members in the tile (but not all members of those relations). If input data contains metadata fields (that is OSM id, version and date) the resulting files can be used by OSM editors just as data from the API. Naturally the data will be at least a bit stale and that needs to be taken in to account when using it in an editor.</p>
<p>Having all of Switzerland (not exactly an empty country in OSM) currently will use 1.1GB, which compares quite well to the original PBF file it was generated from (421MB). Some of the overhead is due to having to duplicate ways crossing tile boundaries and including relations in every tile that has a member element and tiles with little content not compressing well.</p>
<p>To update the tiles it is currently necessary to re-tile the data (after either downloading a new extract or keeping the extract up to date from the diffs). This is not a big deal, generating the tiles for Switzerland from scratch only takes a couple of minutes, but naturally the holy grail is to update in situ on device, doing away with the need for a desktop completely. There are some hurdles that need to be taken before we are there, but it seems to be completely possible. Even if that turns out to be not practical there are some potentially interesting intermediate steps that I'm exploring, for example updating the tiles with the local edits (after they have been uploaded and received definitive IDs).</p>
<p>While you can simply download the <a href="https://github.com/simonpoole/mapsplit/releases">current release</a> and generate files yourself, to make life easier for user that just want to quickly try things out, I'm generating some files for some regions on a daily basis on <a href="https://mapsplit.poole.ch/">https://mapsplit.poole.ch/</a>. Within reason I can add more if there is interest.</p>
<p>To configure MapSplit files as a data source in Vespucci, see the <a href="http://vespucci.io/help/en/13.0.0%20Release%20notes/#add-support-for-mapsplit-tiled-osm-data">13.0 release notes</a>.</p></div>
                    
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
	    <!--            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p> -->
	    <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> for Vespucci 18.0.0 </p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
